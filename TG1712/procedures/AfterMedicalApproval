DELIMITER //

CREATE TRIGGER AfterMedicalApproval
AFTER UPDATE ON Medical
FOR EACH ROW
BEGIN
    -- Run only when approval changes from 0 to 1
    IF COALESCE(OLD.approved, 0) = 0 AND NEW.approved = 1 THEN
        
        -- 1. Update the attendance for that exact session
        UPDATE Attendance
        SET status = 'present'
        WHERE student_id = NEW.student_id
          AND session_id = NEW.session_id
          AND status IN ('absent', 'medical');
          
    END IF;
END;
//

DELIMITER ;
