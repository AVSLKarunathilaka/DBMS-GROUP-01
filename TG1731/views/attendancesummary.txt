CREATE OR REPLACE VIEW AttendanceSummaryByCourse AS
SELECT
    s.course_code,
    c.name AS course_name,
    COUNT(DISTINCT e.student_id) AS total_students,  -- from Enrollment
    COUNT(DISTINCT s.session_id) AS total_sessions,
    
    -- Calculate average attendance percentage per course
    ROUND(
        (SUM(CASE WHEN a.status = 'present' THEN 1 ELSE 0 END) / NULLIF(COUNT(a.status),0)) * 100,
        2
    ) AS average_attendance_percentage

FROM Session s
LEFT JOIN Attendance a ON s.session_id = a.session_id
LEFT JOIN Course c ON s.course_code = c.course_code
LEFT JOIN Enrollment e ON s.course_code = e.course_code  -- join with Enrollment table
GROUP BY s.course_code, c.name
ORDER BY s.course_code;
