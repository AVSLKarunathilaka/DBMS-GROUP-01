CREATE OR REPLACE VIEW final_mark AS
SELECT
    s.registration_no,
    c.course_code,
    CASE
        WHEN es.eligibility_status = 'Eligible' 
        THEN ROUND(COALESCE(c.ca_total, 0) + COALESCE(e.end_total, 0), 2)
        ELSE 0
    END AS final_total
FROM CAView c
LEFT JOIN EndMarkView e 
    ON c.student_id = e.student_id 
   AND c.course_code = e.course_code
LEFT JOIN EligibleStudentsView es 
    ON c.student_id = es.student_id 
   AND es.course_code = c.course_code
JOIN Student s 
    ON c.student_id = s.user_id;